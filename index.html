<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Welcome to wxq&#39;s Blog created in 2017-01-01</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Welcome to wxq's Blog created in 2017-01-01">
<meta property="og:url" content="http://www.digmyth.com/index.html">
<meta property="og:site_name" content="Welcome to wxq's Blog created in 2017-01-01">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Welcome to wxq's Blog created in 2017-01-01">
  
    <link rel="alternate" href="/atom.xml" title="Welcome to wxq&#39;s Blog created in 2017-01-01" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome to wxq&#39;s Blog created in 2017-01-01</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.digmyth.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/05/hello-world/" class="article-date">
  <time datetime="2017-09-05T07:23:51.560Z" itemprop="datePublished">2017-09-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/随笔/">随笔</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/05/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/09/05/hello-world/" data-id="cj779qydl00090sjxo2rmq8au" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ceph-luminous安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/05/ceph-luminous安装/" class="article-date">
  <time datetime="2017-09-05T01:41:54.000Z" itemprop="datePublished">2017-09-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Ceph/">Ceph</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/05/ceph-luminous安装/">ceph-luminous安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 这里只简单列下luminous12.X 安装，默认存储引警Bluestore及监控界面</p>
<p>1  /etc/hosts解析略<br>2  ntpservers时间同步略<br>3  系统配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/SELINUX=.*/SELINUX=disabled/&apos; /etc/selinux/config</div><div class="line">setenforce 0</div><div class="line">systemctl stop firewalld </div><div class="line">systemctl disable firewalld</div><div class="line">systemctl  stop NetworkManager</div><div class="line">systemctl  disable NetworkManager</div></pre></td></tr></table></figure></p>
<p>添加yum源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@cluster-sql ~]# cat ceph.repo </div><div class="line">[ceph]</div><div class="line">name=ceph</div><div class="line">baseurl=http://mirrors.163.com/ceph/rpm-luminous/el7/x86_64/</div><div class="line">gpgcheck=0</div><div class="line">[ceph-noarch]</div><div class="line">name=cephnoarch</div><div class="line">baseurl=http://mirrors.163.com/ceph/rpm-luminous/el7/noarch/</div><div class="line">gpgcheck=0</div></pre></td></tr></table></figure></p>
<p>4   新建集群<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># mkdir /mnt/cluster</div><div class="line"># cd /mnt/cluster</div><div class="line"> </div><div class="line"># yum -y install ceph-deploy</div><div class="line"># ceph-deploy  install --no-adjust-repos node01 node02 node03</div><div class="line"># ceph-deploy  new  node01 node02 node03</div></pre></td></tr></table></figure></p>
<p>5  生成原始文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ls /mnt/cluster</div><div class="line">ceph.conf  ceph-deploy-ceph.log  ceph.mon.keyring</div></pre></td></tr></table></figure></p>
<p>6  根据需要更新原始文件<br>添加需的ceph.conf配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# cat ceph.conf </div><div class="line">[global]</div><div class="line">fsid = d8fa6509-0196-41bc-838e-6226c927e680</div><div class="line">mon_initial_members = node01, node02, node03</div><div class="line">mon_host = 192.168.1.10,192.168.1.11,192.168.1.12</div><div class="line">auth_cluster_required = cephx</div><div class="line">auth_service_required = cephx</div><div class="line">auth_client_required = cephx</div><div class="line"></div><div class="line">mon_allow_pool_delete=true</div><div class="line"></div><div class="line">[mgr]</div><div class="line">mgr modules = dashboard</div></pre></td></tr></table></figure></p>
<p>7 初始化同时推送配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ceph-deploy mon create-initial</div></pre></td></tr></table></figure></p>
<p>9 推送密钥文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph-deploy  admin node01 node02 node03</div></pre></td></tr></table></figure></p>
<p>10 查看集群状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph  -s</div><div class="line">  cluster:</div><div class="line">    id:     d8fa6509-0196-41bc-838e-6226c927e680</div><div class="line">    health: HEALTH_WARN</div><div class="line">            clock skew detected on mon.node02, mon.node03</div><div class="line"> </div><div class="line">  services:</div><div class="line">    mon: 3 daemons, quorum node01,node02,node03</div><div class="line">    mgr: no daemons active</div><div class="line">    osd: 0 osds: 0 up, 0 in</div><div class="line"> </div><div class="line">  data:</div><div class="line">    pools:   0 pools, 0 pgs</div><div class="line">    objects: 0 objects, 0 bytes</div><div class="line">    usage:   0 kB used, 0 kB / 0 kB avail</div><div class="line">    pgs:</div></pre></td></tr></table></figure></p>
<p>11  添加激活osd磁盘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph-deploy  osd create --bluestore node01:/dev/sdb node02:/dev/sdb node03:/dev/sdb --zap-disk</div><div class="line"></div><div class="line">[root@node01 cluster]# ls</div><div class="line">ceph.bootstrap-mds.keyring  ceph.bootstrap-osd.keyring  ceph.client.admin.keyring  ceph-deploy-ceph.log</div><div class="line">ceph.bootstrap-mgr.keyring  ceph.bootstrap-rgw.keyring  ceph.conf                  ceph.mon.keyring</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@node01 cluster]# systemctl  status ceph-osd@2  # 查看单个osd进程</div><div class="line">[root@node01 cluster]# ceph -s</div><div class="line">  cluster:</div><div class="line">    id:     d8fa6509-0196-41bc-838e-6226c927e680</div><div class="line">    health: HEALTH_WARN</div><div class="line">            no active mgr</div><div class="line">            clock skew detected on mon.node02, mon.node03</div><div class="line"> </div><div class="line">  services:</div><div class="line">    mon: 3 daemons, quorum node01,node02,node03</div><div class="line">    mgr: no daemons active</div><div class="line">    osd: 3 osds: 3 up, 3 in</div><div class="line"> </div><div class="line">  data:</div><div class="line">    pools:   0 pools, 0 pgs</div><div class="line">    objects: 0 objects, 0 bytes</div><div class="line">    usage:   0 kB used, 0 kB / 0 kB avail</div><div class="line">    pgs:</div><div class="line">         </div><div class="line"> ####[root@node01 cluster]# ceph quorum_status --format json-pretty</div><div class="line">[root@node01 cluster]# ceph  osd tree</div><div class="line">ID CLASS WEIGHT  TYPE NAME       STATUS REWEIGHT PRI-AFF </div><div class="line">-1       0.14607 root default                            </div><div class="line">-3       0.04869     host node01                         </div><div class="line"> 0   hdd 0.04869         osd.0       up  1.00000 1.00000 </div><div class="line">-5       0.04869     host node02                         </div><div class="line"> 1   hdd 0.04869         osd.1       up  1.00000 1.00000 </div><div class="line">-7       0.04869     host node03                         </div><div class="line"> 2   hdd 0.04869         osd.2       up  1.00000 1.00000 </div><div class="line">[root@node01 cluster]# df  -hT</div><div class="line">Filesystem          Type      Size  Used Avail Use% Mounted on</div><div class="line">/dev/mapper/vg-root xfs        16G  1.7G   14G  11% /</div><div class="line">devtmpfs            devtmpfs  482M     0  482M   0% /dev</div><div class="line">tmpfs               tmpfs     493M     0  493M   0% /dev/shm</div><div class="line">tmpfs               tmpfs     493M  6.9M  486M   2% /run</div><div class="line">tmpfs               tmpfs     493M     0  493M   0% /sys/fs/cgroup</div><div class="line">/dev/sda1           xfs       497M  159M  338M  32% /boot</div><div class="line">/dev/mapper/vg-data xfs       3.9G   33M  3.9G   1% /data</div><div class="line">tmpfs               tmpfs      99M     0   99M   0% /run/user/0</div><div class="line">/dev/sdb1           xfs        97M  5.4M   92M   6% /var/lib/ceph/osd/ceph-0</div><div class="line">[root@node01 cluster]# cat /var/lib/ceph/osd/ceph-0/type </div><div class="line">bluestore</div><div class="line">[root@node01 cluster]# parted /dev/sdb print</div><div class="line">Model: VMware, VMware Virtual S (scsi)</div><div class="line">Disk /dev/sdb: 53.7GB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: gpt</div><div class="line">Disk Flags: </div><div class="line"></div><div class="line">Number  Start   End     Size    File system  Name        Flags</div><div class="line"> 1      1049kB  106MB   105MB   xfs          ceph data</div><div class="line"> 2      106MB   53.7GB  53.6GB               ceph block</div></pre></td></tr></table></figure>
<p>12 配置ceph-mgr<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph-deploy  mgr  create  node01  node02 node03</div></pre></td></tr></table></figure></p>
<p>可以看到己被激活<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph -s</div><div class="line">  cluster:</div><div class="line">    id:     d8fa6509-0196-41bc-838e-6226c927e680</div><div class="line">    health: HEALTH_WARN</div><div class="line">            clock skew detected on mon.node02, mon.node03</div><div class="line"> </div><div class="line">  services:</div><div class="line">    mon: 3 daemons, quorum node01,node02,node03</div><div class="line">    mgr: node01(active), standbys: node02, node03</div><div class="line">    osd: 3 osds: 3 up, 3 in</div><div class="line"> </div><div class="line">  data:</div><div class="line">    pools:   0 pools, 0 pgs</div><div class="line">    objects: 0 objects, 0 bytes</div><div class="line">    usage:   3164 MB used, 146 GB / 149 GB avail</div><div class="line">    pgs:</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@node01 cluster]# ceph config-key put mgr/dashboard/server_addr  192.168.1.10</div><div class="line">set mgr/dashboard/server_addr</div><div class="line">[root@node01 cluster]# ceph config-key put mgr/dashboard/server_port 7000</div><div class="line">set mgr/dashboard/server_port</div><div class="line"></div><div class="line">[root@node01 cluster]# ceph mgr  module enable dashboard</div><div class="line">[root@node01 cluster]# ceph mgr  module ls</div><div class="line">[</div><div class="line">    &quot;dashboard&quot;,</div><div class="line">    &quot;restful&quot;,</div><div class="line">    &quot;status&quot;</div><div class="line">]</div><div class="line"></div><div class="line">[root@node01 cluster]# netstat -tnlp | grep 7000</div><div class="line">tcp        0      0 192.168.1.10:7000       0.0.0.0:*               LISTEN      34774/ceph-mgr</div></pre></td></tr></table></figure>
<p>13 ceph-fs部署<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># ceph-deploy   mds  create node01 node02 node03</div><div class="line"># ceph osd pool create cephfs_data &lt;pg_num&gt;</div><div class="line"># ceph osd pool create cephfs_metadata &lt;pg_num&gt;</div><div class="line"></div><div class="line"># ceph fs new cephfs cephfs_metadata cephfs_data</div></pre></td></tr></table></figure></p>
<h2 id="总结几点"><a href="#总结几点" class="headerlink" title="总结几点"></a>总结几点</h2><p>1 ceph quorum_status –format json-pretty 可查看选举详情<br>2 ceph osd pool application enable volumes rbd 标记一个池的应用(cephfs/rbd/rgw),不标记可以使用但集群状态将为warning<br>3 保护机制的存在默认删除池是不允许的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ceph cluster]# ceph --show-config | grep delete</div><div class="line">mon_allow_pool_delete = false</div><div class="line">mon_fake_pool_delete = false</div><div class="line">osd_pool_default_flag_nodelete = false</div><div class="line">rbd_mirror_delete_retry_interval = 30.000000</div></pre></td></tr></table></figure></p>
<p>需要编辑ceph.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[global]</div><div class="line">mon_allow_pool_delete=true</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/09/05/ceph-luminous安装/" data-id="cj779qydd00030sjxedy33v4f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-基于CentOS 7的PXE装机" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/01/基于CentOS 7的PXE装机/" class="article-date">
  <time datetime="2017-07-01T01:41:54.000Z" itemprop="datePublished">2017-07-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/01/基于CentOS 7的PXE装机/">基于CentOS 7的PXE装机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>网上各种贴子各种飞总说不到重点，本人表示不喜欢。</code></p>
<h3 id="基于Centos7PXE装机"><a href="#基于Centos7PXE装机" class="headerlink" title="基于Centos7PXE装机"></a>基于Centos7PXE装机</h3><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li>pxe装机依赖几个服务： dhcp/tftp/fileserver</li>
<li>dhcp:  为装机分配地址及指明tftp server服务器是谁，下载什么文件</li>
<li>tftp:   提供网络引导文件pxelinux.0及内核文件vmlinuz、initrd.img<ul>
<li>(具体文件： boot.msg  initrd.img  pxelinux.0  pxelinux.cfg  splash.png  vesamenu.c32  vmlinuz)</li>
</ul>
</li>
<li>fileserver: 提供安装树输出，一般指yum repository (yum 仓库或yum源)</li>
<li>syslinux:   网络引导文件pxelinux.0由syslinux软件包提供</li>
</ul>
<h2 id="dhcp服务"><a href="#dhcp服务" class="headerlink" title="dhcp服务"></a>dhcp服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum  -y install  dhcp</div><div class="line">rpm -ql dhcp</div><div class="line">/etc/dhcp/dhcpd.conf      # 主配置文件</div><div class="line">/var/lib/dhcpd/dhcpd.leases  # 租约文件</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# cat /etc/dhcp/dhcpd.conf  | grep -v ^# | grep -v ^$</div><div class="line">option domain-name &quot;digmyth.com&quot;;</div><div class="line">option domain-name-servers 114.114.114.114;</div><div class="line">default-lease-time 600;</div><div class="line">max-lease-time 7200;</div><div class="line">log-facility local7;</div><div class="line">subnet 172.16.10.0 netmask 255.255.255.0 &#123;</div><div class="line">  range 172.16.10.20 172.16.10.30;</div><div class="line">  option domain-name-servers 172.16.10.1;</div><div class="line">  option domain-name &quot;digmyth.com&quot;;</div><div class="line">  option routers 172.16.10.254;</div><div class="line">  default-lease-time 600;</div><div class="line">  max-lease-time 7200;</div><div class="line">&#125;</div><div class="line">filename &quot;pxelinux.0&quot;;     # 定义网络引导文件名</div><div class="line">next-server 172.16.10.1;   # 定义tftp server地址</div></pre></td></tr></table></figure>
<p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># systemctl  start dhcpd</div><div class="line">[root@master ~]# netstat -unlp | grep 67</div><div class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           995/dhcpd</div></pre></td></tr></table></figure></p>
<h2 id="syslinux提供引导文件"><a href="#syslinux提供引导文件" class="headerlink" title="syslinux提供引导文件"></a>syslinux提供引导文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">准备网络引导文件pxelinux.0  相当于bootloader</div><div class="line"># yum -y install syslinux</div><div class="line">[root@master tftpboot]# ll /usr/share/syslinux/pxelinux.0 </div><div class="line">-rw-r--r--. 1 root root 26764 Nov  6  2016 /usr/share/syslinux/pxelinux.0</div></pre></td></tr></table></figure>
<h2 id="tftp-server"><a href="#tftp-server" class="headerlink" title="tftp server"></a>tftp server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># yum  -y install tftp tftp-server</div><div class="line">[root@master ~]# rpm -ql tftp-server</div><div class="line">/etc/xinetd.d/tftp   # 启动文件</div><div class="line">/usr/sbin/in.tftpd</div><div class="line">/var/lib/tftpboot   # 服务根目录</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># cat /etc/xinetd.d/tftp</div><div class="line">service tftp</div><div class="line">&#123;</div><div class="line">	socket_type		= dgram</div><div class="line">	protocol		= udp</div><div class="line">	wait			= yes</div><div class="line">	user			= root</div><div class="line">	server			= /usr/sbin/in.tftpd</div><div class="line">	server_args		= -s /var/lib/tftpboot</div><div class="line">    disable			= no  #改为no</div><div class="line">	per_source		= 11</div><div class="line">	cps			= 100 2</div><div class="line">	flags			= IPv4</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>启动tftp服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># cp  /usr/share/syslinux/pxelinux.0  /var/lit/tftpboot</div><div class="line"># systemctl  start tftp</div><div class="line"># tftp localhost</div><div class="line">&gt; get pxelinux.0   # 测试成功</div></pre></td></tr></table></figure></p>
<h2 id="准备内核及其它相关文件"><a href="#准备内核及其它相关文件" class="headerlink" title="准备内核及其它相关文件"></a>准备内核及其它相关文件</h2><p>   此时<code>pxe</code>己经能够获得地址并下载<code>pxelinux.0</code>进行网络引导，接下来是下载内核文件<code>vmlinuz</code>、<code>initrd.img</code>继续完成装机。<br> 这里我拿<code>CentOS7.2</code>为例：<code>CentOS-7-x86_64-DVD-1511.iso</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# mount -o loop CentOS-7-x86_64-DVD-1511.iso  /mnt</div><div class="line">mount: /dev/loop0 is write-protected, mounting read-only</div><div class="line">[root@master pxeboot]# cd /mnt/images/pxeboot/</div><div class="line">[root@master pxeboot]# cp vmlinuz /var/lib/tftpboot/</div><div class="line">[root@master pxeboot]# cp initrd.img  /var/lib/tftpboot/</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mkdir /var/lib/tftpboot/pxelinux.cfg</div><div class="line">cp /mnt/isolinux/isolinux.cfg  /var/lib/tftpboot/pxelinux.cfg /default </div><div class="line">[root@master pxelinux.cfg]# cat default </div><div class="line">default vesamenu.c32</div><div class="line">#default linux   # 这里是一个标签，对找后面相应的label</div><div class="line">timeout 600</div><div class="line"></div><div class="line">menu title CentOS 7 wxq    # 此处定义title</div><div class="line">label linux</div><div class="line">  menu label ^Install CentOS 7  # 此处定义系统安装时显示版本</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img method=http://172.16.10.1/pub/ ks=http://172.16.10.1/pxe/CentOS72.ks</div><div class="line"># 注意： 如果此处只定义method,那么装机过程将全手动。</div></pre></td></tr></table></figure>
<p>此外还有一些额外文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# ls /mnt/isolinux/</div><div class="line">boot.cat  grub.conf   isolinux.bin  memtest     TRANS.TBL    vesamenu.c32</div><div class="line">boot.msg  initrd.img  isolinux.cfg  splash.png  upgrade.img  vmlinuz</div><div class="line">[root@master ~]# ll /var/lib/tftpboot/</div><div class="line">boot.msg  initrd.img  pxelinux.0   splash.png  vesamenu.c32  vmlinuz</div></pre></td></tr></table></figure></p>
<h2 id="定义安装树"><a href="#定义安装树" class="headerlink" title="定义安装树"></a>定义安装树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># yum  -y install httpd</div><div class="line"># mkdir /var/www/html/pxe</div><div class="line"># mkdir /var/www/html/pub</div><div class="line"># mount --bind /mnt /var/www/html/pub/ </div><div class="line"># systemctl  start httpd</div></pre></td></tr></table></figure>
<h2 id="定义ks文件"><a href="#定义ks文件" class="headerlink" title="定义ks文件"></a>定义ks文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">/pxe/CentOS72.ks</div><div class="line">[root@master pxe]# cat CentOS72.ks</div><div class="line">#version=DEVEL</div><div class="line"># System authorization information</div><div class="line"></div><div class="line">install</div><div class="line"># Keyboard layouts</div><div class="line">keyboard --vckeymap=us --xlayouts=&apos;us&apos;</div><div class="line">auth --enableshadow --passalgo=sha512</div><div class="line"></div><div class="line"># Use CDROM installation media</div><div class="line"># Run the Setup Agent on first boot</div><div class="line">#firstboot --enable</div><div class="line"># System language</div><div class="line">lang en_US.UTF-8</div><div class="line"></div><div class="line">url --url=http://172.16.10.1/pub/</div><div class="line"># Use graphical install</div><div class="line">graphical</div><div class="line">#text</div><div class="line"></div><div class="line">selinux --disabled</div><div class="line">skipx</div><div class="line"></div><div class="line">reboot</div><div class="line"></div><div class="line"># Network information</div><div class="line">#network  --bootproto=static --device=ens33 --gateway=172.16.10.254 --ip=172.16.10.30 --nameserver=114.114.114.114 --netmask=255.255.255.0 --onboot=on --ipv6=auto --activate</div><div class="line">network  --bootproto=dhcp --device=ens33 --onboot=yes --ipv6=auto --activate</div><div class="line">network  --hostname=digmyth</div><div class="line"></div><div class="line"># Root password=123456</div><div class="line">rootpw --iscrypted $6$6ErC1johQ5LVAYwQ$cGGxb6Q6./SpvXCZs.K39d9LpV/IeFnspUT6mHmsVsARzToRCSsZ4fLxcOh0tYWpt38Yh6JoMzmSEkEtCtMlS/</div><div class="line"># System services</div><div class="line">services --disabled=&quot;chronyd&quot;</div><div class="line"></div><div class="line"># System timezone</div><div class="line">timezone Asia/Shanghai --isUtc --nontp</div><div class="line"># System bootloader configuration</div><div class="line">clearpart --all --initlabel</div><div class="line">bootloader --append=&quot; crashkernel=auto&quot; --location=mbr --boot-drive=sda</div><div class="line"># Partition clearing information</div><div class="line"></div><div class="line">#clearpart --drives=sda --initlabel</div><div class="line">#clearpart --none --initlabel</div><div class="line"># Disk partitioning information</div><div class="line"></div><div class="line">#ignoredisk --only-use=sda</div><div class="line">#part pv.735 --fstype=&quot;lvmpv&quot; --ondisk=sda --size=19979</div><div class="line">#volgroup vg --pesize=4096 pv.735</div><div class="line">#logvol /boot --fstype=&quot;xfs&quot; --size=500 --name=boot --vgname=vg</div><div class="line">#logvol /  --fstype=&quot;xfs&quot; --size=16000 --name=root --vgname=vg</div><div class="line">#logvol /data  --fstype=&quot;xfs&quot; --size=3000 --name=data --vgname=vg</div><div class="line">#logvol swap --fstype=&quot;swap&quot; --grow --size=1</div><div class="line"></div><div class="line"></div><div class="line">%packages</div><div class="line">@^minimal</div><div class="line">@core</div><div class="line">kexec-tools</div><div class="line">vim</div><div class="line">net-tools</div><div class="line">sysstat</div><div class="line"></div><div class="line">%end</div><div class="line"></div><div class="line">%post</div><div class="line">touch /root/wxq.txt</div><div class="line">%end</div><div class="line"></div><div class="line">%addon com_redhat_kdump --enable --reserve-mb=&apos;auto&apos;</div><div class="line">%end</div></pre></td></tr></table></figure>
<p>上面的装机将进入图形界面手动分区安装<br><img src="http://i1.buimg.com/586082/0e07e78ed0b06283.png" alt="enter image description here"></p>
<p>到此完结，可以结合cobbler实现多pxe环境并存。</p>
<ul>
<li>cobbler 一些概念：</li>
<li>distro发行版： 其实就是pxe所说的相应内核文件</li>
<li>profile:  提供pxeboot引导文件、KS文件、安装树（用现有iso镜像mirror/import方式）</li>
</ul>
<h5 id="是不是很完美-。。。"><a href="#是不是很完美-。。。" class="headerlink" title="是不是很完美 。。。"></a>是不是很完美 。。。</h5>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/07/01/基于CentOS 7的PXE装机/" data-id="cj779qyfd001i0sjx27ha4ztp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux-iptables应用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/15/linux-iptables应用/" class="article-date">
  <time datetime="2017-06-15T01:42:54.000Z" itemprop="datePublished">2017-06-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/15/linux-iptables应用/">linux_iptables应用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="iptables-规则应用总结"><a href="#iptables-规则应用总结" class="headerlink" title="iptables 规则应用总结"></a>iptables 规则应用总结</h2><p>防火墙端口重定向规则<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -I PREROUTING -i eth1  -p tcp --dport 80 -j REDIRECT --to 8080</div></pre></td></tr></table></figure></p>
<p>反向代理防火墙规则<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -I INPUT  -d 123.125.168.130 -i eth0 -p tcp  --dport 80 -j ACCEPT</div><div class="line">iptables -I INPUT -s 10.10.10.0/24 -i eth1 -p tcp  --sport 9999 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>此包为input状态检测可省略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -I OUTPUT -p tcp -o eth1 -s 10.10.10.1  -d 10.10.10.10 --dport 9999  -j ACCEPT</div><div class="line">iptables -I OUTPUT -p tcp -o eth0 -s 123.125.168.130  --sport 80 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>目标地址转换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -I PREROUTING -i eth0 -d 123.125.168.130  -p tcp --dport 80 -j DNAT  --to 10.10.10.10:9999</div><div class="line">iptables -A FORWARD -d 10.10.10.10 -p tcp  --dport 9999 -j ACCEPT</div><div class="line">iptables -A FORWARD -s 10.10.10.10 -p tcp  --sport 9999 -j ACCEPT</div></pre></td></tr></table></figure></p>
<p>如果10.10.10.10机器默认网关不是10.10.10.1或没有指网关,则网关防火墙需如下:有点奇怪的规则<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -I POSTROUTING -d 10.10.10.10 -p tcp --dport 9999 -j SNAT --to 10.10.10.1</div></pre></td></tr></table></figure></p>
<p>源地址转换：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -t nat -I POSTROUTING -s  10.10.10.0/24 -o eth0 -j SNAT --to 123.125.168.130</div><div class="line">iptables -t nat -I POSTROUTING -s  10.10.10.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p>
<p>此条开销较大，与上条可二选一<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables  -I FORWARD -s 10.10.10.0/24 -j ACCEPT  注：forward不指网卡，要指也是内网卡</div><div class="line">iptables  -I FORWARD -d 10.10.10.0/24 -j ACCEPT</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/06/15/linux-iptables应用/" data-id="cj779qydo000c0sjx1ny0otul" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python加密解密加签验签" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/15/python加密解密加签验签/" class="article-date">
  <time datetime="2017-05-15T12:51:41.000Z" itemprop="datePublished">2017-05-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/python加密解密加签验签/">python-加密解密加签验签</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="python加密解密，加签验签"><a href="#python加密解密，加签验签" class="headerlink" title="python加密解密，加签验签"></a>python加密解密，加签验签</h2><p>(转)<br>在与第三方服务对接时，加密与解密，加签与验签是这个过程中的关键一步</p>
<p>一般情况下，对接服务中会有两对公私钥。使用对方公钥进行加密，使用自己私钥进行加签。传回来的数据，使用自己的私钥解密，使用对方的公钥验签。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import base64</div><div class="line">from Crypto.PublicKey import RSA</div><div class="line">from Crypto.Hash import SHA</div><div class="line">from Crypto.Cipher import PKCS1_v1_5</div><div class="line">from Crypto.Signature import PKCS1_v1_5 as SIGN_PKCS</div><div class="line"></div><div class="line">PUB_KEY = RSA.importKey(open(&apos;rsa_public_key.pem&apos;,&apos;r&apos;).read())</div><div class="line">PRI_KEY = RSA.importKey(open(&apos;rsa_private_key.pem&apos;,&apos;r&apos;).read())</div></pre></td></tr></table></figure></p>
<p>加密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">def split_data(l, n):</div><div class="line">    for i in range(0, len(l), n):</div><div class="line">        yield l[i: i+n]</div><div class="line">        </div><div class="line">def encrypt(params):</div><div class="line">    raw = params.encode(&apos;utf-8&apos;)</div><div class="line">    cipher = PKCS1_v1_5.new(PUB_KEY)</div><div class="line">    ＃ 加密超长字节117个字节一加密</div><div class="line">    content = b&apos;&apos;.join([cipher.encrypt(x) for x in chunks(raw, 117)])</div><div class="line">    return base64.b64encode(content)</div><div class="line">``` </div><div class="line">解密</div></pre></td></tr></table></figure>
<p>def decrypt(data):<br>    raw = data.encode(‘utf-8’)<br>    decrypt = PKCS1_v1_5.new(PRI_KEY).decrypt</p>
<pre><code># 解密超长字符128一解密
content = b&apos;&apos;.join(decrypt(x, object()) for x in chunks(raw, 128))
return content.decode()
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">加签</div></pre></td></tr></table></figure>
<p>def signer(data):<br>    signstr = data.encode(‘utf-8’)<br>    sign = SIGN_PKCS.new(PRI_KEY).sign(SHA.new(signstr))<br>    return base64.b64encode(sign)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">验签</div></pre></td></tr></table></figure></p>
<p>def verify_sign(unsign, raw_sign):</p>
<pre><code># unsign: 签名
# raw_sign: 待验证签名
assert SIGN_PKCS.new(PUB_KEY).verify(SHA.new(unsign.encode(&apos;utf-8&apos;)), raw_sign)
</code></pre><p>```</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/05/15/python加密解密加签验签/" data-id="cj779qyf5001a0sjxl9lvo78z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-10-02-网络编程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/31/python-10-02-网络编程/" class="article-date">
  <time datetime="2017-03-31T14:26:46.000Z" itemprop="datePublished">2017-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/31/python-10-02-网络编程/">python-09-02-网络编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
<li></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/03/31/python-10-02-网络编程/" data-id="cj779qyex00160sjxrukkipz6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-08-02-异常" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/25/python-08-02-异常/" class="article-date">
  <time datetime="2017-03-25T12:39:12.000Z" itemprop="datePublished">2017-03-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/25/python-08-02-异常/">python-08-02-异常</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
<li>1</li>
<li>2</li>
<li>3</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class WxqException(Exception):</div><div class="line">    def __init__(self, msg):</div><div class="line">        self.message = msg</div><div class="line">    def __str__(self):</div><div class="line">        return self.message</div><div class="line"></div><div class="line">try:</div><div class="line">        raise WxqException(&quot;Game Over!&quot;)</div><div class="line">except WxqException as e:</div><div class="line">    print(e)</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/03/25/python-08-02-异常/" data-id="cj779qyet00120sjx1wjtdrwb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-09-01-进程和线程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/python-09-01-进程和线程/" class="article-date">
  <time datetime="2017-03-20T14:26:37.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/python-09-01-进程和线程/">python-09-01-进程和线程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
<li></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/03/20/python-09-01-进程和线程/" data-id="cj779qyev00140sjxsqju36wt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-08-01-面象对象高级编程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/15/python-08-01-面象对象高级编程/" class="article-date">
  <time datetime="2017-03-15T14:28:41.000Z" itemprop="datePublished">2017-03-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/15/python-08-01-面象对象高级编程/">python-08-01-面象对象高级编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
<li>staticmethod</li>
<li>classmethod</li>
</ul>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><h2 id="staticmethod"><a href="#staticmethod" class="headerlink" title="staticmethod"></a>staticmethod</h2><p>几个魔法方法说明：</p>
<p><code>@classmethod</code>   <code>@staticmethod</code><br>不依赖任何具体的对象来执行类当中是方法，这个方法要么是静态方法， 要么是类方法，要么是属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@classmethod</div><div class="line">def test_func(cls):   # 类方法传入cls参数（类本身）</div><div class="line">    pass</div><div class="line"></div><div class="line">@staticmethod</div><div class="line">def test_func():    # 静态方法时没有任何变量</div><div class="line">    pass</div><div class="line"></div><div class="line">def test_func(self):  # 普通实例方法时传入self参数（实例本身）</div><div class="line">    pass</div></pre></td></tr></table></figure>
<p><code>staticmethod</code>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">In [4]: class Foo(object):</div><div class="line">   ...:     @staticmethod</div><div class="line">   ...:     def spam(x,y,z):   # 静态方法时方法定义不写self</div><div class="line">   ...:         print(x,y,z)</div><div class="line">       </div><div class="line">In [5]: </div><div class="line">In [5]: Foo.spam(1,2,3)      # 静态方法属于类的，用类名调用。虽然实例能调用，但不要那样混用,不规范</div><div class="line">1 2 3</div></pre></td></tr></table></figure></p>
<p><code>staticmethod</code>用法场景<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">In [7]: import time</div><div class="line">In [6]: class Date(object):</div><div class="line">   ...:     def __init__(self,year,mon, day):</div><div class="line">   ...:         self.year = year</div><div class="line">   ...:         self.mon = mon</div><div class="line">   ...:         self.day = day</div><div class="line">   ...:     @staticmethod</div><div class="line">   ...:     def now():</div><div class="line">   ...:         t = time.localtime()</div><div class="line">   ...:         return Date(t.tm_year, t.tm_mon, t.tm_mday)</div><div class="line">   ...:     </div><div class="line"></div><div class="line">In [8]: d1 = Date(1989, 8,20)    # 获得一个对象</div><div class="line"></div><div class="line">In [9]: d2 = Date.now()   # 这里也能获得一个对象</div><div class="line"></div><div class="line">In [10]: d1.day</div><div class="line">Out[10]: 20</div><div class="line"></div><div class="line">In [11]: d2.day</div><div class="line">Out[11]: 12</div></pre></td></tr></table></figure></p>
<h2 id="classmethod"><a href="#classmethod" class="headerlink" title="classmethod"></a>classmethod</h2><p><code>@classmethod</code>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">In [12]: class C1(object):</div><div class="line">   ....:     name = &apos;wxq&apos;</div><div class="line">   ....:     @classmethod</div><div class="line">   ....:     def test(cls):    # 这里需要传入cls, 谁调用谁就是cls</div><div class="line">   ....:         print(cls, cls.name)</div><div class="line">   ....:         </div><div class="line"></div><div class="line">In [14]: C1.test()     # 这里cls就是C1</div><div class="line">&lt;class &apos;__main__.C1&apos;&gt; wxq</div><div class="line"></div><div class="line">In [13]: c = C1()   # 正常实例化对象</div></pre></td></tr></table></figure></p>
<p><code>@classmethod</code>用法场景<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">In [2]: import time</div><div class="line"></div><div class="line">In [3]: class Date(object):</div><div class="line">   ...:     def __init__(self, year, mon,day):</div><div class="line">   ...:         self.year = year</div><div class="line">   ...:         self.mon = mon</div><div class="line">   ...:         self.day = day</div><div class="line">   ...:     @classmethod</div><div class="line">   ...:     def now(cls):</div><div class="line">   ...:         t = time.localtime()</div><div class="line">   ...:         return cls(t.tm_year, t.tm_mon, t.tm_mday)</div><div class="line">   ...:     </div><div class="line"></div><div class="line">In [4]: d = Date.now()</div><div class="line"></div><div class="line">In [5]: print(d.year,d.mon, d.day)</div><div class="line">2017 3 12</div></pre></td></tr></table></figure></p>
<p><code>staticmethod</code>与<code>classmethod</code>区别的牛逼之处<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~# cat method.py </div><div class="line">#!/usr/bin/env python3</div><div class="line">import time</div><div class="line">class Date(object):</div><div class="line">    def __init__(self, year,mon,day):</div><div class="line">        self.year = year</div><div class="line">        self.mon = mon</div><div class="line">        self.day = day</div><div class="line">    @staticmethod</div><div class="line">    def now():</div><div class="line">        t = time.localtime()</div><div class="line">        return Date(t.tm_year, t.tm_mon, t.tm_mday)</div><div class="line"></div><div class="line">class EuroDate(Date):</div><div class="line">     def __str__(self):</div><div class="line">       return &apos;year: %s mon:%s day:%s&apos; % (self.year, self.mon,self.day)</div><div class="line"></div><div class="line">e = EuroDate.now()</div><div class="line">print(e)</div><div class="line">root@ubuntu:~# python3 method.py </div><div class="line">&lt;__main__.Date object at 0x7f5514658940&gt;</div></pre></td></tr></table></figure></p>
<p>上面并没有我们想要的结果<br>分析：<br><code>e = EuroDate.now()</code>实例化时，EuroDate类并没有now()方法，但继承自Date类，它会去调父类Date.now()方法实例化。<br>也就是<code>return Date(t.tm_year, t.tm_mon, t.tm_mday)</code>, 实例print时调Date类的<code>__str__</code>方法，故打印<code>return Date(t.tm_year, t.tm_mon, t.tm_mday)</code>后的内存地址，不会打印<code>EuroDate</code>类中定义的<code>__str__</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~# cat goodmethod.py </div><div class="line">#!/usr/bin/env python3</div><div class="line">import time</div><div class="line">class Date(object):</div><div class="line">    def __init__(self, year,mon,day):</div><div class="line">        self.year = year</div><div class="line">        self.mon = mon</div><div class="line">        self.day = day</div><div class="line">    @classmethod</div><div class="line">    def now(cls):</div><div class="line">        t = time.localtime()</div><div class="line">        return cls(t.tm_year, t.tm_mon, t.tm_mday)</div><div class="line"></div><div class="line">class EuroDate(Date):</div><div class="line">     def __str__(self):</div><div class="line">       return &apos;year: %s mon:%s day:%s&apos; % (self.year, self.mon,self.day)</div><div class="line"></div><div class="line">e = EuroDate.now()</div><div class="line">print(e)</div><div class="line">root@ubuntu:~# python3 goodmethod.py </div><div class="line">year: 2017 mon:3 day:12</div></pre></td></tr></table></figure>
<p>这样才是我们想要的结果，好象参悟了点什么<br>分析:<br><code>e = EuroDate.now()</code>实例化时，EuroDate类并没有now()方法，但继承自Date类，它会去调父类Date.now()方法实例化。这一点和上面是一致的。但此时<code>return cls(t.tm_year, t.tm_mon, t.tm_mday)</code>中的cls不是Date,而是EuroDate,符合谁调谁就是cls的原则。这样实例化<code>e = EuroDate.now()</code>时print(e)就会去调EuroDate中的<code>__str__</code>方法，得到我们想要的结果</p>
<p>小结：<br><code>staticmethod</code>与<code>classmethod</code>在一定场景中是有区别的。细节参照上面的例子练习</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/03/15/python-08-01-面象对象高级编程/" data-id="cj779qyer00100sjxqhze6ijt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-06-01-正则表达式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/01/python-06-01-正则表达式/" class="article-date">
  <time datetime="2017-03-01T09:03:01.000Z" itemprop="datePublished">2017-03-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/01/python-06-01-正则表达式/">python-06-01-正则表达式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
<li>基础</li>
<li>进阶</li>
<li>re模块</li>
<li>分组</li>
<li>切分字符串</li>
<li>编译compile</li>
<li>贪婪模式匹配</li>
</ul>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>元字符：(Meta-Characters)是正则表达式中具有特殊意义的专用字符<br>比如：\d表示数字 \s表示空格 \w表示[a-zA-Z0-9_]大小写字母数字下划线<br>元字符表 <a href="http://www.runoob.com/regexp/regexp-metachar.html" target="_blank" rel="external">链接</a><br>字符类：又字符集，一组可以匹配[ ]中字符串的字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">.                     # 任意单个字符</div><div class="line">[]                    # 集合内</div><div class="line">[^]                   # 集合内取反</div><div class="line">?                     # 表示前一个字符长度为0或1</div><div class="line">+                     # 表示前一个字符长度为1或1以上</div><div class="line">*                     # 表示前一个字符长度为任意，等同于?+的并集</div><div class="line">&#123;m&#125;</div><div class="line">&#123;m,n&#125;</div><div class="line">&#123;0,n&#125;</div><div class="line">&#123;m,&#125;</div><div class="line">^</div><div class="line">$</div><div class="line">pat1|pat2</div><div class="line">()         	      # 分组</div><div class="line">\b                    # 嘛意思</div><div class="line">[0-9]  \d</div><div class="line">[0-9a-zA-Z_]  \w</div><div class="line">\s         	      # 任意空白字符</div><div class="line">\nn</div><div class="line">a*?                   # 这里？使用非贪婪模式（正则表达式默认工作在贪婪模式，尽可能多的去匹配）</div><div class="line">(*|+|?|&#123;&#125;)?`          # 使用非贪婪模式</div><div class="line">match 		      # 只匹配首项以开头的，与shell中^相同</div></pre></td></tr></table></figure></p>
<h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h2 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.search(r&apos;wxq&apos;, &apos;I love wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 10), match=&apos;wxq&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; res = re.search(r&apos;wxq&apos;, &apos;I love wxq&apos;)</div><div class="line">&gt;&gt;&gt; print(res)</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 10), match=&apos;wxq&apos;&gt;              # 没有匹配到打印为None</div><div class="line"></div><div class="line">&gt;&gt;&gt; res.group()                                                 # 匹配到时用.group()取出匹配结果 </div><div class="line">&apos;wxq&apos;</div><div class="line"></div><div class="line">&gt;&gt;&gt; &quot;I love wxq &quot;.find(&apos;wxq&apos;)</div><div class="line">7</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;.&apos;, &apos;I love digmyth.com&apos;)                       # 匹配任意单个字符，所以匹配到&quot;I&quot;</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 1), match=&apos;I&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;\.&apos;, &apos;I love digmyth.com&apos;)                      # 只匹配.需要转义</div><div class="line">&lt;_sre.SRE_Match object; span=(14, 15), match=&apos;.&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;wx.&apos;, &apos;I love wxq.com&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 10), match=&apos;wxq&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;\d&apos;, &apos;I love 123 wxq&apos;)                          # 匹配单个数字</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 8), match=&apos;1&apos;&gt;</div><div class="line"> </div><div class="line">&gt;&gt;&gt; re.search(r&apos;\d\d\d&apos;, &apos;I love 123 wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 10), match=&apos;123&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;\d\d\d.\d\d\d.\d\d\d.\d\d\d&apos;, &apos;192.168.100.10&apos;)   # 少一位匹配不到</div><div class="line">&gt;&gt;&gt; re.search(r&apos;\d\d\d.\d\d\d.\d\d\d.\d\d\d&apos;, &apos;192.168.100.100&apos;)  # 匹配到</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 15), match=&apos;192.168.100.100&apos;&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.search(r&apos;[aeiou]&apos;, &apos;I love wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(3, 4), match=&apos;o&apos;&gt;</div><div class="line">&gt;&gt;&gt; re.search(r&apos;[aeiouAEIOU]&apos;, &apos;I love wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 1), match=&apos;I&apos;&gt;</div><div class="line">&gt;&gt;&gt; re.search(r&apos;[a-z]&apos;, &apos;I love wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(2, 3), match=&apos;l&apos;&gt;</div><div class="line"> </div><div class="line">&gt;&gt;&gt; re.search(r&apos;[2-9]&apos;, &apos;I love 123  wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(8, 9), match=&apos;2&apos;&gt;</div><div class="line"> </div><div class="line">&gt;&gt;&gt; re.search(r&apos;[0-9]&apos;, &apos;I love 123  wxq&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(7, 8), match=&apos;1&apos;&gt;</div><div class="line">&gt;&gt;&gt; re.search(r&apos;ab&#123;3&#125;c&apos;, &apos;abbbc&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 5), match=&apos;abbbc&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;ab&#123;3,10&#125;c&apos;, &apos;abbbbbc&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 7), match=&apos;abbbbbc&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;[0-255]&apos;, &apos;188&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 1), match=&apos;1&apos;&gt;</div><div class="line">&gt;&gt;&gt; </div><div class="line">&gt;&gt;&gt; re.search(r&apos;[0-2][0-5][0-5]&apos;, &apos;188&apos;)                  # 没有匹配到</div><div class="line">&gt;&gt;&gt; </div><div class="line">&gt;&gt;&gt; re.search(r&apos;[01]\d\d|2[0-2]\d|25[0-5]&apos;, &apos;188&apos;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 3), match=&apos;188&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;([01]\d\d|2[0-4]\d|25[0-5]\.&#123;3&#125;([01]\d\d|2[0-4]\d|25[0-5]))&apos;, &apos;192.168.1.1&apos;)   # 只匹配到192</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 3), match=&apos;192&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;([01]\d\d|2[0-4]\d|25[0-5])\.&#123;3&#125;([01]\d\d|2[0-4]\d|25[0-5])&apos;, &apos;192.168.1.1&apos;)   # 匹配不到</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;([01]\d\d|2[0-4]\d|25[0-5]\.)&#123;3&#125;([01]\d\d|2[0-4]\d|25[0-5])&apos;, &apos;192.168.1.1&apos;)   # 匹配不到</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;(([01]\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;([01]\d\d|2[0-4]\d|25[0-5])&apos;, &apos;192.168.1.1&apos;) # 匹配不到</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;(([01]?\d?\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;([01]?\d?\d|2[0-4]\d|25[0-5])&apos;, &apos;192.168.1.1&apos;) # 匹配有误细看</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 11), match=&apos;192.168.1.1&apos;&gt;</div></pre></td></tr></table></figure>
<p>ip地址匹配最终完美写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.search(r&apos;(([01]?\d?\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;([01]?\d?\d|2[0-4]\d|25[0-5])&apos;, &apos;192.168.240.240&apos;)  # 匹配有误细看</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 14), match=&apos;192.168.240.24&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;(([01]?\d?\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[0-1]?\d?\d)&apos;, &apos;192.168.240.240&apos;) # 这个写法完美</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 15), match=&apos;192.168.240.240&apos;&gt;</div></pre></td></tr></table></figure></p>
<p>[0-255]表示的是0，1，2后跟上55<br>[0-2][0-5][0-5]只是三个占位上的数字，没有个位，百位这样的区分，当然不能匹配188了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.search(r&apos;(daemon_D)&#123;3&#125;&apos;, &apos;daemon_Ddaemon_Ddaemon_D&apos;)       # 重复</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 24), match=&apos;daemon_Ddaemon_Ddaemon_D&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;(daemon_D)&#123;1, 5&#125;&apos;, &apos;daemon_Ddaemon_Ddaemon_D&apos;)    # 注意没有空格</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;(daemon_D)&#123;1,5&#125;&apos;, &apos;daemon_Ddaemon_Ddaemon_D&apos;)     # 匹配到了</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 24), match=&apos;daemon_Ddaemon_Ddaemon_D&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; s = &quot;&lt;html&gt;&lt;title&gt;I love www.digmyth.com&lt;/title&gt;&lt;/html&gt;&quot;</div><div class="line">&gt;&gt;&gt; re.search(r&apos;&lt;.+?&gt;&apos;, s)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 6), match=&apos;&lt;html&gt;&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; re.search(r&apos;&lt;.+&gt;&apos;, s)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 50), match=&apos;&lt;html&gt;&lt;title&gt;I love www.digmyth.com&lt;/title&gt;&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.findall(r&apos;\bFishC\b&apos;, &quot;FishC.com!FishC_com!(FishC)&quot;)       # 待续。#^#</div><div class="line">[&apos;FishC&apos;, &apos;FishC&apos;]</div><div class="line">&gt;&gt;&gt; </div><div class="line">&gt;&gt;&gt; re.findall(r&apos;\w&apos;, &quot;牛X工作室Love_FishC_com!)&quot;)</div><div class="line">[&apos;牛&apos;, &apos;X&apos;, &apos;工&apos;, &apos;作&apos;, &apos;室&apos;, &apos;L&apos;, &apos;o&apos;, &apos;v&apos;, &apos;e&apos;, &apos;_&apos;, &apos;F&apos;, &apos;i&apos;, &apos;s&apos;, &apos;h&apos;, &apos;C&apos;, &apos;_&apos;, &apos;c&apos;, &apos;o&apos;, &apos;m&apos;]</div></pre></td></tr></table></figure>
<p><code>re-replace/sub</code>的例子如下<br>字符串的strip方法只能去前后空格、字符串的replace方法是字符替换、re.sub方法也是替换功能。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; name = &apos; w   x   q&apos;</div><div class="line">&gt;&gt;&gt; name.strip()</div><div class="line">&apos;w   x   q&apos;</div><div class="line">&gt;&gt;&gt; name.replace(&apos; &apos;, &apos;&apos;)</div><div class="line">&apos;wxq&apos;</div><div class="line">&gt;&gt;&gt; re.sub(&apos; &apos;, &apos;&apos;, name)</div><div class="line">&apos;wxq&apos;</div><div class="line">&gt;&gt;&gt; re.sub(&apos;wxq&apos;, &apos;love&apos;, &apos;I wxq wxq wxq&apos;, count=2)</div><div class="line">&apos;I love love wxq&apos;</div></pre></td></tr></table></figure></p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>eg1:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; name = re.search(r&apos;wxq&apos;, &apos;I love wxq&apos;)</div><div class="line">&gt;&gt;&gt; name.group()                       # .group()打印匹配对象</div><div class="line">&apos;wxq&apos;</div></pre></td></tr></table></figure></p>
<p>eg2:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s = &apos;aa bb cc dd  &apos;</div><div class="line">&gt;&gt;&gt; p = re.compile(r&apos;\w+\s+\w+&apos;)       #  匹配单词空格单词这样的分组</div><div class="line">&gt;&gt;&gt; p.findall(s)                       #  匹配分为了2组</div><div class="line">[&apos;aa bb&apos;, &apos;cc dd&apos;]</div><div class="line">&gt;&gt;&gt; p = re.compile(r&apos;(\w+)\s+\w+&apos;)     #  只匹配单词空格单词中括号那个单词</div><div class="line">&gt;&gt;&gt; p.findall(s)</div><div class="line">[&apos;aa&apos;, &apos;cc&apos;]</div><div class="line">&gt;&gt;&gt; p = re.compile(r&apos;((\w+)\s+\w+)&apos;)   #  先打印外括号，后打印内括号，先后内容组成元组，最后列表呈现</div><div class="line">&gt;&gt;&gt; p.findall(s)</div><div class="line">[(&apos;aa bb&apos;, &apos;aa&apos;), (&apos;cc dd&apos;, &apos;cc&apos;)]</div></pre></td></tr></table></figure></p>
<p>eg3:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.search(&quot;(?P&lt;province&gt;[0-9]&#123;4&#125;)(?P&lt;city&gt;[0-9]&#123;2&#125;(?P&lt;birthday&gt;[0-9]&#123;4&#125;))&quot;, &quot;371481199306143242&quot;).groupdict()</div><div class="line">&#123;&apos;province&apos;: &apos;3714&apos;, &apos;birthday&apos;: &apos;1993&apos;, &apos;city&apos;: &apos;811993&apos;&#125;</div></pre></td></tr></table></figure></p>
<h2 id="切分字符串"><a href="#切分字符串" class="headerlink" title="切分字符串"></a>切分字符串</h2><p><code>re.split用法</code><br>split 以至少2个空格为分隔,  两种写法:<br>re.split(r’\s{2,}’,  str)<br>re.split(r’\s\s+’，str)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import re</div><div class="line">&gt;&gt;&gt; re.split(r&apos;\s&#123;2,&#125;&apos;, &apos;17:19:28 up  2:00,  3 users,  load average: 0.01, 0.03, 0.05&apos;) # 以2个空隔分割字符串返回列表</div><div class="line">[&apos;17:19:28 up&apos;, &apos;2:00,&apos;, &apos;3 users,&apos;, &apos;load average: 0.01, 0.03, 0.05&apos;]</div><div class="line">&gt;&gt;&gt; re.split(r&apos;\s\s+&apos;, &apos;17:19:28 up  2:00,  3 users,  load average: 0.01, 0.03, 0.05&apos;)</div><div class="line">[&apos;17:19:28 up&apos;, &apos;2:00,&apos;, &apos;3 users,&apos;, &apos;load average: 0.01, 0.03, 0.05&apos;]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># cat whodata.txt</div><div class="line"> 17:24:49 up  2:05,  3 users,  load average: 0.00, 0.02, 0.05</div><div class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</div><div class="line">root     pts/1    192.168.109.1    15:33    9.00s  0.17s  0.04s python3</div><div class="line">&gt;&gt;&gt; import re</div><div class="line">&gt;&gt;&gt; with open(&apos;whodata.txt&apos;, &apos;r&apos;) as f:</div><div class="line">...     for line in f:</div><div class="line">...         res = re.split(&apos;\s\s+&apos;, line)</div><div class="line">...         print(res)</div><div class="line">... </div><div class="line">[&apos; 17:24:49 up&apos;, &apos;2:05,&apos;, &apos;3 users,&apos;, &apos;load average: 0.00, 0.02, 0.05\n&apos;]</div><div class="line">[&apos;USER&apos;, &apos;TTY&apos;, &apos;FROM&apos;, &apos;LOGIN@&apos;, &apos;IDLE&apos;, &apos;JCPU&apos;, &apos;PCPU WHAT\n&apos;]</div><div class="line">[&apos;root&apos;, &apos;pts/1&apos;, &apos;192.168.109.1&apos;, &apos;15:33&apos;, &apos;9.00s&apos;, &apos;0.17s&apos;, &apos;0.04s python3\n&apos;]</div></pre></td></tr></table></figure>
<p>eg1:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; re.sub(&apos; &apos;, &apos;&apos;, name)</div><div class="line">&apos;wxq&apos;</div><div class="line">&gt;&gt;&gt; p = re.compile(&apos;\.&apos;)</div><div class="line">&gt;&gt;&gt; p.split(&apos;www.digmyth.com&apos;)</div><div class="line">[&apos;www&apos;, &apos;digmyth&apos;, &apos;com&apos;]</div><div class="line">&gt;&gt;&gt; url = &apos;www.digmyth.com&apos;</div><div class="line">&gt;&gt;&gt; re.compile(&apos;\.&apos;).split(url)</div><div class="line">[&apos;www&apos;, &apos;digmyth&apos;, &apos;com&apos;]</div><div class="line">&gt;&gt;&gt; re.sub(&apos;www&apos;, &apos;mail&apos;, url)</div><div class="line">&apos;mail.digmyth.com&apos;</div><div class="line">&gt;&gt;&gt; url.split(&apos;.&apos;)</div><div class="line">[&apos;www&apos;, &apos;digmyth&apos;, &apos;com&apos;]</div></pre></td></tr></table></figure></p>
<p>eg2:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import re</div><div class="line">&gt;&gt;&gt; name = &apos;hello    world&apos;</div><div class="line">&gt;&gt;&gt; str_a, str_b = re.split(r&apos;\s+&apos;, name)</div><div class="line">&gt;&gt;&gt; str_a, str_b</div><div class="line">(&apos;hello&apos;, &apos;world&apos;)</div><div class="line">&gt;&gt;&gt; str_a</div><div class="line">&apos;hello&apos;</div><div class="line">&gt;&gt;&gt; str_b</div><div class="line">&apos;world&apos;</div></pre></td></tr></table></figure></p>
<p>eg3:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~# cat put_split.py </div><div class="line">#!/usr/bin/env python3</div><div class="line">import os</div><div class="line">import re</div><div class="line">input = input(&quot;enter you str: &quot;).strip()</div><div class="line">cmd, path = re.split(r&apos;\s+&apos;, input)</div><div class="line">print(cmd.strip())</div><div class="line">print(path.strip())</div><div class="line">root@ubuntu:~# python3 put_split.py </div><div class="line">enter you str:    put /root/demo.txt</div><div class="line">put</div><div class="line">/root/demo.txt</div></pre></td></tr></table></figure></p>
<h2 id="编译compile"><a href="#编译compile" class="headerlink" title="编译compile"></a>编译compile</h2><p>正则表达式工作流程： 检测语法–&gt; 编译–&gt; 匹配<br>当一个正则表达式多次调用时，建议预先编译好，后续直接用于匹配以提高效率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; p = re.compile(r&apos;[A-Z]&apos;)</div><div class="line">&gt;&gt;&gt; type(p)</div><div class="line">&lt;class &apos;_sre.SRE_Pattern&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; p.search(&quot;I Love www.DigMyth.Com&quot;)</div><div class="line">&lt;_sre.SRE_Match object; span=(0, 1), match=&apos;I&apos;&gt;</div><div class="line"></div><div class="line">&gt;&gt;&gt; p.findall(&quot;I LLove www.DigMyth.Com&quot;)</div><div class="line">[&apos;I&apos;, &apos;L&apos;, &apos;L&apos;, &apos;D&apos;, &apos;M&apos;, &apos;C&apos;]</div></pre></td></tr></table></figure>
<h2 id="贪婪模式匹配"><a href="#贪婪模式匹配" class="headerlink" title="贪婪模式匹配"></a>贪婪模式匹配</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2017/03/01/python-06-01-正则表达式/" data-id="cj779qyel000w0sjxzxx36ff8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Ceph/">Ceph</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/声明/">声明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/09/05/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/09/05/ceph-luminous安装/">ceph-luminous安装</a>
          </li>
        
          <li>
            <a href="/2017/07/01/基于CentOS 7的PXE装机/">基于CentOS 7的PXE装机</a>
          </li>
        
          <li>
            <a href="/2017/06/15/linux-iptables应用/">linux_iptables应用</a>
          </li>
        
          <li>
            <a href="/2017/05/15/python加密解密加签验签/">python-加密解密加签验签</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 wxq<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>